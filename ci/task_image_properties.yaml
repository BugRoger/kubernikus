---
platform: 'linux'

image_resource:
  type: docker-image
  source:
    repository: alpine 
    tag: '3.6'

inputs:
  - name: image

outputs:
  - name: image.properties

run:
  path: /bin/sh
  args:
    - -c
    - |
      set -exo pipefail
      DIGEST=$(cat image/digest)
      REPOSITORY=$(cat image/repository)
      TAG=$(cat image/tag)
      cat >"image.properties/properties.json" <<EOF
      {
        "DIGEST": "$DIGEST",
        "REPOSITORY": "$REPOSITORY",
        "TAG": "$TAG"
      }
      EOF
